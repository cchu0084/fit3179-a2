{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Butterfly chart for Melanoma.",
  "data": { "url": "data/Skin Cancer incidence and mortality.csv" },
  "width": 400,
  "height": {"step": 40},

 "params": [
  {
    "name": "Year",
    "value": 2019,
    "bind": {
      "input": "range",
      "min": 2012,
      "max": 2020,
      "step": 1
    }
  },
  {
    "name": "Sex",
    "value": "Persons",
    "bind": {
      "input": "select",
      "options": ["Persons", "Males", "Females"]
    }
  }
],

  "transform": [
    { "filter": "datum['Cancer group/site'] === 'Melanoma of the skin'" },
    { "filter": "toNumber(datum.Year) == Year" },
    { "filter": "datum.Sex == Sex" }
  ],

  "spacing": 0,
  "hconcat": [
    {
      "transform": [
        { "filter": "datum['Data type'] === 'Incidence'" },
        {
          "calculate": "toNumber(replace(datum['Age-standardised rate\\n2024 Australian population \\n(per 100,000)'], ',', ''))",
          "as": "Rate"
        },
        { "calculate": "-datum.Rate", "as": "signedRate" }
      ],
      "title": { "text": "Incidence", "fontSize": 15, "fontWeight": 600 },
      "mark": "bar",
      "encoding": {
        "y": {
          "field": "State or Territory",
          "type": "ordinal",
          "axis": null,
          "sort": "descending"
        },
        "x": {
          "aggregate": "mean",
          "field": "signedRate",
          "title": "ASR (per 100,000 population)",
          "axis": {
            "labelExpr": "format(abs(datum.value), ',')",
            "grid": true,
            "ticks": true,
            "domain": false,
            "titleFontSize": 12,
            "labelPadding": 3
          }
        },
        "color": { "value": "#f2c94c" },
        "tooltip": [
          { "field": "State or Territory", "type": "nominal", "title": "State:" },
          { "field": "Rate", "type": "quantitative", "title": "ASR:", "format": "," }
        ]
      },
      "width": 230
    },

    {
      "width": 20,
      "view": { "stroke": null },
      "mark": { "type": "text", "align": "center", "baseline": "middle", "fontSize": 12, "fontWeight": 320 },
      "encoding": {
        "y": { "field": "State or Territory", "type": "ordinal", "axis": null, "sort": "descending" },
        "text": { "field": "State or Territory", "type": "nominal" }
      }
    },

    {
      "transform": [
        { "filter": "datum['Data type'] === 'Mortality'" },
        {
          "calculate": "toNumber(replace(datum['Age-standardised rate\\n2024 Australian population \\n(per 100,000)'], ',', ''))",
          "as": "Rate"
        },
        { "calculate": "datum.Rate", "as": "signedRate" }
      ],
      "title": { "text": "Mortality", "fontSize": 15, "fontWeight": 600 },
      "mark": "bar",
      "encoding": {
        "y": {
          "field": "State or Territory",
          "type": "ordinal",
          "axis": null,
          "sort": "descending"
        },
        "x": {
          "aggregate": "mean",
          "field": "signedRate",
          "title": "ASR (per 100,000 population)",
          "axis": {
            "labelExpr": "format(datum.value, ',')",
            "grid": true,
            "ticks": true,
            "domain": false,
            "titleFontSize": 12,
            "labelPadding": 3
          }
        },
        "color": { "value": "pink" },
        "tooltip": [
          { "field": "State or Territory", "type": "nominal", "title": "State:" },
          { "field": "Rate", "type": "quantitative", "title": "ASR:", "format": "," }
        ]
      },
      "width": 230
    }
  ],

  "config": {
    "view": { "stroke": null },
    "axis": { "grid": true, "labelFontSize": 12 }
  }
}
